<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inscripción 7° Año EBI | Liceo Dr. Aníbal Acosta Estapé</title>
  <style>
    :root {
      --rojo: #c41e3a;
      --rojo-oscuro: #a0172e;
      --gris-claro: #f8f9fa;
      --texto: #333;
    }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(to bottom, #f8f9fa, #ffffff);
      padding: 20px;
      margin: 0;
      color: var(--texto);
    }
    .container {
      max-width: 560px;
      margin: 30px auto;
      background: white;
      padding: 35px 30px;
      border-radius: 16px;
      box-shadow: 0 12px 35px rgba(0,0,0,0.12);
      border-top: 6px solid var(--rojo);
    }
    header {
      text-align: center;
      margin-bottom: 25px;
    }
    h1 {
      color: var(--rojo);
      font-size: 1.8rem;
      margin: 0 0 8px 0;
    }
    .subtitulo {
      color: #555;
      font-size: 1.02rem;
      margin: 0;
    }
    label {
      display: block;
      margin-top: 20px;
      font-weight: 600;
      color: #444;
      font-size: 1rem;
    }
    input, select {
      width: 100%;
      padding: 12px 14px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1.5px solid #ccc;
      font-size: 1rem;
      transition: border 0.3s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--rojo);
      box-shadow: 0 0 0 3px rgba(196,30,58,0.15);
    }
    button {
      margin-top: 32px;
      width: 100%;
      padding: 15px;
      font-size: 1.1rem;
      font-weight: bold;
      background: var(--rojo);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }
    button:hover {
      background: var(--rojo-oscuro);
      transform: translateY(-2px);
    }
    .exito {
      margin-top: 25px;
      padding: 18px;
      background: #e8f5e8;
      border-left: 5px solid #28a745;
      border-radius: 8px;
      display: none;
      text-align: center;
      font-size: 1rem;
      color: #155724;
    }
    .exito strong { display: block; font-size: 1.25rem; margin-bottom: 8px; }

    @media (max-width: 600px) {
      .container { padding: 25px 20px; margin: 15px auto; }
      h1 { font-size: 1.55rem; }
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Inscripción 7° Año EBI</h1>
    <p class="subtitulo">Liceo Dr. Aníbal Acosta Estapé</p>
  </header>

  <p style="text-align:center; color:#555; line-height:1.6;">
    Complete el siguiente formulario para reservar su turno de inscripción.<br>
    <strong>Fechas disponibles:</strong> 11, 12 y 13 de febrero de 2026<br>
    <strong>Cupo por horario:</strong> máximo 4 personas
  </p>

  <label>Nombre y Apellido completo</label>
  <input type="text" id="nombre" placeholder="Ejemplo: Juan Carlos Gómez Pérez" required>

  <label>Cédula de Identidad (con puntos y guión)</label>
  <input type="text" id="cedula" placeholder="Ejemplo: 5.123.456-7" required>

  <label>Número de celular (con código de área)</label>
  <input type="tel" id="celular" placeholder="Ejemplo: 091 234 567" required>

  <label>Fecha deseada</label>
  <input type="date" id="fecha" required min="2026-02-11" max="2026-02-13">

  <label>Horario preferido</label>
  <select id="hora" required>
    <option value="" disabled selected>Seleccione un horario</option>
    <option>08:00</option><option>08:15</option><option>08:30</option><option>08:45</option>
    <option>09:00</option><option>09:15</option><option>09:30</option><option>09:45</option>
    <option>10:00</option><option>10:15</option><option>10:30</option><option>10:45</option>
    <option>11:00</option><option>11:15</option><option>11:30</option><option>11:45</option>
    <option>12:00</option>
  </select>

  <button onclick="confirmar()">Confirmar reserva de turno</button>

  <div class="exito" id="exito"></div>
</div>

<script>
  // Evitar que la misma persona se inscriba dos veces
  if (localStorage.getItem('datosInscripcion7EBI')) {
    window.location.href = 'comprobante.html';
  }

  async function confirmar() {
    const nombre   = document.getElementById('nombre').value.trim();
    const cedula   = document.getElementById('cedula').value.trim();
    const celular  = document.getElementById('celular').value.trim();
    const fecha    = document.getElementById('fecha').value;   // formato YYYY-MM-DD
    const hora     = document.getElementById('hora').value;

    if (!nombre || !cedula || !celular || !fecha || !hora) {
      alert('Por favor, complete todos los campos requeridos.');
      return;
    }

    const claveTurno = fecha + ' ' + hora;
    let turnos = JSON.parse(localStorage.getItem('turnosOcupados7EBI')) || {};
    if (!turnos[claveTurno]) turnos[claveTurno] = 0;

    // Control de cupo (máximo 4 por horario)
    if (turnos[claveTurno] >= 4) {
      document.getElementById('resultado').style.display = 'block';
      document.getElementById('resultado').innerHTML = `
        <strong>Horario no disponible</strong><br><br>
        El horario del <strong>${formatearFecha(fecha)}</strong> a las <strong>${hora} hs</strong> 
        ya alcanzó el cupo máximo de 4 turnos.<br><br>
        Por favor seleccione otro horario.
      `;
      return;
    }

    // === ENVÍO A GOOGLE SHEETS (tu formulario real) ===
    const FORM_ID = '1FAIpQLSeHFtwCQ7B8oBQfNWhq3wU4cOTebLK_VsZx64NcHe63EZF49Q';

    const formData = new FormData();
    formData.append('entry.1901770451', nombre);   // Nombre y Apellido
    formData.append('entry.1378321971', cedula);   // Cédula
    formData.append('entry.1564440647', celular);  // Celular

    // Fecha (separada en año, mes, día)
    const [year, month, day] = fecha.split('-');
    formData.append('entry.1133455154_year',  year);
    formData.append('entry.1133455154_month', month);
    formData.append('entry.1133455154_day',   day);

    // Hora (separada en hora y minuto)
    const [h, m] = hora.split(':');
    formData.append('entry.1858262101_hour',   h);
    formData.append('entry.1858262101_minute', m);

    try {
      await fetch(`https://docs.google.com/forms/d/e/${FORM_ID}/formResponse`, {
        method: 'POST',
        mode: 'no-cors',
        body: formData
      });

      // === FORZAMOS que siga como si todo salió bien ===
      // (porque en la realidad SÍ llega a Google)

      turnos[claveTurno]++;
      localStorage.setItem('turnosOcupados7EBI', JSON.stringify(turnos));

      const datos = { nombre, cedula, celular, fecha, hora };
      localStorage.setItem('datosInscripcion7EBI', JSON.stringify(datos));

      const lugaresRestantes = 4 - turnos[claveTurno];
      const mensajeLugares = lugaresRestantes === 0
        ? 'Ha sido el último turno disponible en este horario.'
        : `Quedan ${lugaresRestantes} turno(s) disponible(s) en este horario.`;

      document.getElementById('resultado').classList.add('exito');
      document.getElementById('resultado').style.display = 'block';
      document.getElementById('resultado').innerHTML = `
        <strong>¡Turno reservado con éxito!</strong><br><br>
        Estimado/a <strong>${nombre}</strong>,<br><br>
        Su turno quedó confirmado para el <strong>${formatearFecha(fecha)}</strong> 
        a las <strong>${hora} hs</strong>.<br><br>
        ${mensajeLugares}<br><br>
        Los datos fueron registrados correctamente en planilla.<br>
        Redirigiendo al comprobante...
      `;

      setTimeout(() => {
        window.location.href = 'comprobante.html';
      }, 4500);

    } catch (err) {
      alert('Ocurrió un error al enviar los datos. Por favor, intente nuevamente.');
    }
  }

  function formatearFecha(iso) {
    const opciones = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
    return new Date(iso).toLocaleDateString('es-UY', opciones);
  }
</script>

</body>
</html>